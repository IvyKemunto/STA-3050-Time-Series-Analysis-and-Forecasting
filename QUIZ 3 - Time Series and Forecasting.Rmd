---
title: "STA3050-Quiz3"
author: "Ivy Kemunto"
date: "2024-06-09"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## The table below shows the number of visitors (in thousands) who visited the national park in each quarter of 2021 and 2022 along with the seasonal index.

$$
\begin{array}{|c|c|c|c|}
\hline
\text{Season} & \text{Seasonal Index} & \text{2021} & \text{2022} \\
\hline
\text{Summer} & 162 & 51 & 54 \\
\hline
\text{Monsoon} & 62 & 28 & 32 \\
\hline
\text{Winter} & 87 & 41 & 45 \\
\hline
\text{Spring} & 89 & 36 & 43 \\
\hline
\end{array}
$$

## 1. Calculate the deseasonalised values for each quarter

The deseasonalized value is calculated using the following formula:

$$
\text{Deseasonalized Value} = \left( \frac{\text{Number of Visitors}}{\text{Seasonal Index}} \right) \times 100
$$

[***Explanation:***]{.underline}

-   **Number of Visitors:** The actual number of visitors in a given season and year.
-   **Seasonal Index:** A factor that represents the seasonal effect for a given period.
-   **Deseasonalized Value:** The number of visitors adjusted for seasonal effects. It removes the seasonal component to better understand the underlying trend and cyclical components.

```{r}
# Data for visitors and seasonal index
visitors<-data.frame(Year=rep(2021:2022,each=4),Season=rep(c("Summer","Monsoon","Winter","Spring"),2),Visitors=c(51,28,41,36,54,32,45,43),Seasonal_Index=c(162,62,87,89,162,62,87,89))
#Getting deseasonalized values
visitors$Deseasonalized<-(visitors$Visitors/visitors$Seasonal_Index)*100
print(visitors)
```

Deseasonalized values provide a way to understand the true underlying pattern in visitor numbers by removing the seasonal component. This helps to identify trends and other components without the distortion caused by regular seasonal variations.

## 2.Compute the trend values for the deseasonalised values

In order to Calculate this question we will use the following:

[**Linear Trend Line Calculation**]{.underline}

The linear trend line is given by the equation:

$$
Y_t = \beta_0 + \beta_1 t
$$

**Where:**

-   $Y_t$ is the value of the trend at time $t$.
-   $\beta_0$ is the intercept of the trend line.
-   $\beta_1$ is the slope of the trend line.
-   $t$ is the time period.

[**Time Transformation**]{.underline}

The time variable $X_t$ is transformed as follows:

$$
X_t = \frac{\text{half of interval in t values}}{t - \text{average of two middle values}} = 2 \times (t - \text{median of t})
$$

[***Purpose of***]{.underline} $X_t$

Centering the time values around zero reduces numerical errors and simplifies the mathematical process when solving for the trend line coefficients. This transformation ensures that the sum of the $X_t$ values is zero, making the normal equations more straightforward to solve.

To find the coefficients $\beta_0$ and $\beta_1$, we use the following normal equations:

[***First Normal Equation:***]{.underline}

$$
\sum Y_t = n \beta_0 + \beta_1 \sum X_t
$$

This equation sums up all the observed values ($Y_t$) and equates it to the total number of observations ($n$) times the intercept ($\beta_0$), plus the sum of the time periods ($\sum X_t$) times the slope ($\beta_1$).

[***Second Normal Equation:***]{.underline}

$$
\sum X_t Y_t = \beta_0 \sum X_t + \beta_1 \sum X_t^2
$$

This equation sums up the product of each time period ($X_t$) and its corresponding observed value ($Y_t$). It equates this to the intercept ($\beta_0$) times the sum of the time periods ($\sum X_t$), plus the slope ($\beta_1$) times the sum of the squared time periods ($\sum X_t^2$).

```{r}
#Adding a time variable to represent each quarter in a sequential manner
visitors$Time<-1:nrow(visitors)
median_time<-median(visitors$Time)
#Creating the Time transformation X_t
visitors$Xt <- 2 * (visitors$Time - median_time)

sum_Xt<-sum(visitors$Xt)
sum_Yt<-sum(visitors$Deseasonalized)
sum_Xt_squared<-sum(visitors$Xt^2)
sum_XtYt<-sum(visitors$Xt*visitors$Deseasonalized)
n<-nrow(visitors)
#Getting the coefficients
beta1<-sum_XtYt/sum_Xt_squared
beta0<-sum_Yt/n
#Getting the trend Values 
visitors$Trend<-beta0+beta1*visitors$Xt
print(visitors)
#Getting the Linear Trend Equation
cat("The linear trend equation is: Yt =", beta0, "+", beta1, "* Xt\n")
```

**Time Transformation** ($X_t$)

The time variable $t$ is transformed to center around zero. The transformation is given by:

$$
X_t = 2 \times (t - \text{median})
$$

For this dataset:

-   The median time is 4.5 (the average of 4 and 5).

The transformed values $X_t$ are calculated as:

$$
\begin{align*}
X_t &= 2 \times (1 - 4.5) = -7 \\
X_t &= 2 \times (2 - 4.5) = -5 \\
X_t &= 2 \times (3 - 4.5) = -3 \\
X_t &= 2 \times (4 - 4.5) = -1 \\
X_t &= 2 \times (5 - 4.5) = 1 \\
X_t &= 2 \times (6 - 4.5) = 3 \\
X_t &= 2 \times (7 - 4.5) = 5 \\
X_t &= 2 \times (8 - 4.5) = 7 \\
\end{align*}
$$

**Trend Values**

The trend values are calculated using the linear trend line equation:

$$
Y_t = \beta_0 + \beta_1 X_t
$$

where:

$$
\begin{align*}
\beta_1 &= \frac{\sum X_t Y_t}{\sum X_t^2} = 0.9344608 \\
\beta_0 &= \frac{\sum Y_t}{n} = 43.65045 \\
\end{align*}
$$

The trend values for each period are:

$$
\begin{align*}
2021 \text{ Summer}: & \quad 43.65045 + 0.9344608 \times -7 = 37.10923 \\
2021 \text{ Monsoon}: & \quad 43.65045 + 0.9344608 \times -5 = 38.97815 \\
2021 \text{ Winter}: & \quad 43.65045 + 0.9344608 \times -3 = 40.84707 \\
2021 \text{ Spring}: & \quad 43.65045 + 0.9344608 \times -1 = 42.71599 \\
2022 \text{ Summer}: & \quad 43.65045 + 0.9344608 \times 1 = 44.58491 \\
2022 \text{ Monsoon}: & \quad 43.65045 + 0.9344608 \times 3 = 46.45384 \\
2022 \text{ Winter}: & \quad 43.65045 + 0.9344608 \times 5 = 48.32276 \\
2022 \text{ Spring}: & \quad 43.65045 + 0.9344608 \times 7 = 50.19168 \\
\end{align*}
$$

**Linear Trend Equation**

The linear trend equation is derived from the least squares method:

$$
Y_t = 43.65045 + 0.9344608 \times X_t
$$

**Interpretation**

-   **Deseasonalized Values:** These values represent the number of visitors after removing the seasonal effects. This helps in identifying underlying trends without the influence of seasonal variations.
-   **Trend Values:** These values represent the underlying trend in the number of visitors over time, without seasonal effects. The trend shows a gradual increase in the number of visitors.
-   **Linear Trend Equation:** This equation provides a mathematical representation of the trend. The coefficient $\beta_1 = 0.9344608$ indicates the rate of change in the number of deseasonalized visitors for each unit change in $X_t$.

## 3. Plot the quarterly number of visitors for 2021 and 2022 and also deseasonalised with trend values on the same axis.

```{r}
library(ggplot2)
ggplot(visitors,aes(x = Time)) +
  geom_line(aes(y = Visitors, color = "Actual Visitors"), size = 1) +
  geom_line(aes(y = Deseasonalized, color = "Deseasonalized Visitors"), size = 1) +
  geom_line(aes(y = Trend, color = "Trend"), size = 1) +
  scale_color_manual(values = c("Actual Visitors" = "pink", "Deseasonalized Visitors" = "red", "Trend" = "orange")) +
  labs(title = "Quarterly Number of Visitors for 2021 and 2022",
       x = "Quarter",
       y = "Number of Visitors",
       color = "Legend") +
  theme_minimal()
```

**Quarterly Trends**

[***Seasonal Variations***]{.underline}

-   The pink line ***(actual visitors)*** shows significant seasonal variations with peaks and troughs. For example, there is a noticeable dip during the Monsoon season in both years and a peak during the Winter season in 2022.
-   The red line ***(deseasonalized visitors)*** has less fluctuation compared to the pink line, indicating that the seasonal component has been removed, revealing the underlying pattern more clearly.

[***Trend Analysis***]{.underline}

-   The orange line ***(trend)*** shows a generally increasing trend over the eight quarters. This indicates a steady increase in the number of visitors to the park when seasonal variations are not considered.
-   The actual visitors' line fluctuates around the trend line, showing the impact of seasonal factors.

[***Quarterly Comparison***]{.underline}

-   The **actual number** of visitors ***(pink line)*** in Summer 2021 and Summer 2022 shows a slight increase, indicating that the park is gaining popularity over time despite seasonal dips.
-   The **deseasonalized** number of visitors ***(red line)*** remains relatively stable but shows an upward trend in the later quarters, aligning with the overall increasing trend.

[***Insights***]{.underline}

-   The park experiences significant seasonal variations, which are evident from the pink line's peaks and troughs.
-   Despite these variations, there is a clear upward trend in the number of visitors, suggesting increasing popularity or better marketing and management efforts over time.
-   The deseasonalized data (red line) helps to identify this underlying trend by removing seasonal effects, making it easier to plan and forecast future visitor numbers.
